<?php
session_start();

include("./php/conn.php"); 
include("./php/read.php");
include("./php/forms.php");
$user_data=check_login($alink);
$a_id=$_GET['a_id'];
$href_back="record_list.html";
if(isset($_GET['arc'])){
  $href_back="record_list_arc.html";
}
?>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>
    Health Status and Arrival Information
  </title>
  <!-- Favicon-->

  <!-- Bootstrap icons-->
  <!-- <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
  <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>

  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

  <!-- Custom styles for this template -->

  <!-- Custom styles for this page -->
  <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
  <!-- Bootstrap icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Core theme CSS (includes Bootstrap)-->

  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="css/styles.css" rel="stylesheet" />
</head>

<body class="d-flex flex-column h-100 bg-image" style="background-image: url('../img/sch4.png'); height: 100vh;
background-repeat: no-repeat;background-size: cover;padding: 0;margin: 0;  background-attachment: fixed;">
  <main class="flex-shrink-0">

    <nav class="navbar navbar-expand-lg navbar-light bg-success p-3 fixed-top">
      <div class="container">
        <a class="nav-link" href="../" style="font-family: Myriad;font-weight: bolder;color: black;font-size: 30px;">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
          aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

      </div>
    </nav>
    <!-- Header-->

    <body style="background-color: blanchedalmond;">



      <!-- style="margin-bottom: 12%;" -->
      <header class="py-5">
        <div class="mt-5">
          <main>
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-lg-12">
                  <div class="card shadow-lg border-0 rounded-lg mt-5">
                    <div class="card-body">
                      <div class="row">

                        <div class="d-flex flex-column flex-shrink-0 col-12">
                          <!-- Start of main -->
                          <div class="card-header mb-3">
                            <h3 class="text-start font-weight-light">Health Status and Arrival Information</h3>
                            <p>Manage record. <span><a href="<?php echo $href_back;?>">Go back.</a></span></p>
                          </div>
                          <div class="card-body">
                            <div class="card" id="tbl_cont">




                            </div>
                          </div>
                          <!-- End of main -->
                        </div>
                        <!-- End of row -->
                      </div>
                      <!-- End of card body -->
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </main>

        </div>
      </header>
    </body>
  </main>



  <div class="modal fade" id="delmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Delete Record</h5>
          <span aria-hidden="true" data-dismiss="modal" style="cursor: pointer;">&times;</span>
        </div>
        <div class="modal-body">Are you sure you want to delete this record?</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-danger" href="./php/call_functions.php?x=delete_both&a_id=<?php
              echo $a_id;
              ?>">Delete</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer-->
  <!-- <footer class="bg-dark py-4 mt-auto">
            <div class="container px-5">
                <div class="row align-items-center justify-content-between flex-column flex-sm-row">
                    <div class="col-auto"><div class="small m-0 text-white">Copyright &copy; <?php echo $abt_name;?> 2022</div></div>
                    <div class="col-auto">

                    </div>
                </div>
            </div>
        </footer> -->
  <style type="text/css">
    @import url('https://fonts.googleapis.com/css2?family=Birthstone&family=Poppins:ital,wght@0,400;0,500;0,600;1,600;1,800&display=swap');
  </style>

  <!-- Bootstrap core JS-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Core theme JS-->
  <script src="js/scripts.js"></script>
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin-2.min.js"></script>
  <script>
    get_hsfm();
    function get_hsfm() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          console.log(this.responseText);
          if (this.responseText != "") {

            document.getElementById("tbl_cont").innerHTML = this.responseText;
          }


        };

      }

      var u = window.location.href;
      var ur = new URL(u);
      var ls = ur.searchParams.get("a_id");
      var arc = 0;
      if (ur.searchParams.get("arc")) {
        arc = 1;
      }
      xhttp.open("GET", "./php/call_functions.php?x=get_hsf_rec&a_id=" + ls + "&arc=" + arc, true);
      xhttp.send();
    }

    function stat(a_id, act) {

      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {

          console.log(this.responseText);
          if (!isNaN(this.responseText) && this.responseText != "") {
            set(a_id, act);
          }

        };

      }
      var formdata = new FormData();

      formdata.append("a_id", a_id);
      formdata.append("resp", act);

      xhttp.open("POST", "../php/contactform/submit_arv.php", true);
      xhttp.send(formdata);
    }


    function set(a_id, act) {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {

          console.log(this.responseText);
          if (!isNaN(this.responseText) && this.responseText != "") {
            location.reload();
          }

        };

      }
      var formdata = new FormData();

      formdata.append("a_id", a_id);
      var fun = "confirm_arr";
      if (act == -1) {
        fun = "decline_arr";
      }
      xhttp.open("POST", "./php/call_functions.php?x=" + fun, true);
      xhttp.send(formdata);
    }
  </script>
</body>

</html>